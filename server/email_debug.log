
> bitnap-server@1.0.0 start
> node dist/server.js

Firebase initialized successfully
Server running on port 3000

=== REQUEST START [2025-08-02T03:00:33.740Z] ===
POST /api/notifications/test-assignment
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Request Body: {
  "ticketId": "ScBZ557KVjy3qgRVxO8f",
  "technicianId": "TyfYVgv06CEjz3dBUX4B"
}
üß™ Testing assignment email for ticket ScBZ557KVjy3qgRVxO8f to technician TyfYVgv06CEjz3dBUX4B
üöÄ Starting notification process for ticket ScBZ557KVjy3qgRVxO8f to technician TyfYVgv06CEjz3dBUX4B
‚ùå Ticket ScBZ557KVjy3qgRVxO8f not found
Response Status: 200
Response Data: {"success":true,"message":"Test assignment email sent successfully","ticketId":"ScBZ557KVjy3qgRVxO8f","technicianId":"TyfYVgv06CEjz3dBUX4B"}
=== REQUEST END [2025-08-02T03:00:33.982Z] ===


=== REQUEST START [2025-08-02T03:00:51.966Z] ===
GET /api/tickets
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Response Status: 200
Response Data: [Large response body]
=== REQUEST END [2025-08-02T03:00:52.027Z] ===


=== REQUEST START [2025-08-02T03:01:01.154Z] ===
POST /api/notifications/test-assignment
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Request Body: {
  "ticketId": "jRHYpFjQEoEAXFRR8NjD",
  "technicianId": "TyfYVgv06CEjz3dBUX4B"
}
üß™ Testing assignment email for ticket jRHYpFjQEoEAXFRR8NjD to technician TyfYVgv06CEjz3dBUX4B
üöÄ Starting notification process for ticket jRHYpFjQEoEAXFRR8NjD to technician TyfYVgv06CEjz3dBUX4B
‚úÖ Ticket data loaded: electric wires got out
‚úÖ Technician data loaded: Roshan Sai Sapram
üìß Creating notification for technician...
üìù Creating notification for user TyfYVgv06CEjz3dBUX4B, type: new_assignment
‚úÖ Notification document created with ID: rBmn42BmHkiVtqkztc66
üì± Sending push notification...
No push subscriptions found for user: TyfYVgv06CEjz3dBUX4B
üìß Sending email notification (priority: high, type: new_assignment)
üìß Starting email notification process for user: TyfYVgv06CEjz3dBUX4B
‚úÖ User email found: sapramroshansai@gmail.com
üìß Ticket data loaded for email: {
  id: 'jRHYpFjQEoEAXFRR8NjD',
  title: 'electric wires got out',
  category: 'maintenance',
  location: ' room no.1002',
  priority: 'high',
  images: 1,
  hasRequiredTools: true,
  hasRequiredMaterials: true
}
üìß Sending email to sapramroshansai@gmail.com: {
  template: 'ai-ticket-assignment',
  subject: 'ü§ñ AI-Recommended Ticket Assigned',
  hasTicket: true,
  ticketId: 'jRHYpFjQEoEAXFRR8NjD',
  dataKeys: [
    'category',
    'location',
    'assignedBy',
    'assignmentMethod',
    'assignmentReason',
    'assignmentScore',
    'estimatedDuration',
    'requiredTools',
    'requiredMaterials',
    'difficultyLevel'
  ]
}
üé® Template rendering started with data keys: [ 'user', 'ticket', 'message', 'title', 'data', 'timestamp' ]
üé® Data structure preview: {
  user: { name: 'Roshan Sai Sapram', email: 'sapramroshansai@gmail.com' },
  ticket: {
    id: 'jRHYpFjQEoEAXFRR8NjD',
    title: 'electric wires got out',
    category: 'maintenance',
    imagesCount: 1
  },
  dataKeys: [
    'category',
    'location',
    'assignedBy',
    'assignmentMethod',
    'assignmentReason',
    'assignmentScore',
    'estimatedDuration',
    'requiredTools',
    'requiredMaterials',
    'difficultyLevel'
  ]
}
üîç Replacing {{user.name}} with: "Roshan Sai Sapram"
üîç Replacing {{ticket.title}} with: "electric wires got out"
üîç Replacing {{ticket.id}} with: "jRHYpFjQEoEAXFRR8NjD"
üîç Replacing {{ticket.category}} with: "maintenance"
üîç Replacing {{ticket.priority}} with: "high"
üîç Replacing {{ticket.priority}} with: "high"
üîç Replacing {{ticket.location}} with: " room no.1002"
üîç Replacing {{timestamp}} with: "8/2/2025"
üîç Replacing {{ticket.description}} with: "electric wires got out"
üîç Replacing {{data.assignmentScore}} with: "95"
üîç Replacing {{data.difficultyLevel}} with: "medium"
üîç Replacing {{data.estimatedDuration}} with: "2-3 hours"
üîç Replacing {{ticket.category}} with: "maintenance"
‚úÖ Template rendering completed
Email sent successfully: <d01105cf-d349-2402-b7e9-140464cb282e@gmail.com>
Email notification sent to sapramroshansai@gmail.com for new_assignment
‚úÖ Email notification process completed
‚úÖ Technician notification created successfully
üìß Creating notification for ticket reporter...
üìù Creating notification for user 1kk5yoDikTybm1IwuGG8, type: assignment
‚úÖ Notification document created with ID: y4lAs01ZSGXv5VWyDLXt
üì± Sending push notification...
No push subscriptions found for user: 1kk5yoDikTybm1IwuGG8
‚è≠Ô∏è Skipping email notification (priority: medium, type: assignment)
‚úÖ Reporter notification created successfully
Response Status: 200
Response Data: {"success":true,"message":"Test assignment email sent successfully","ticketId":"jRHYpFjQEoEAXFRR8NjD","technicianId":"TyfYVgv06CEjz3dBUX4B"}
=== REQUEST END [2025-08-02T03:01:03.809Z] ===


=== REQUEST START [2025-08-02T03:02:27.094Z] ===
GET /api/communities?isActive=true
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { isActive: 'true' }
Response Status: 200
Response Data: {"success":true,"communities":[{"id":"PAWJErgeBMJTEDEuHojc","name":"vnr hostel","managerId":"2Fg6qStQxrCfnNkbmvEh","location":"vnr","description":"boys hostel","address":"vnr gate","contactEmail":"jagadeeswar079@gmail.com","contactPhone":"9700550849","isActive":true,"createdAt":{"_seconds":1754093324,"_nanoseconds":748000000},"updatedAt":{"_seconds":1754093324,"_nanoseconds":748000000}}],"total":1}
=== REQUEST END [2025-08-02T03:02:27.154Z] ===


=== REQUEST START [2025-08-02T03:02:27.157Z] ===
GET /api/communities?isActive=true
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { isActive: 'true' }
Response Status: 200
Response Data: {"success":true,"communities":[{"id":"PAWJErgeBMJTEDEuHojc","name":"vnr hostel","managerId":"2Fg6qStQxrCfnNkbmvEh","location":"vnr","description":"boys hostel","address":"vnr gate","contactEmail":"jagadeeswar079@gmail.com","contactPhone":"9700550849","isActive":true,"createdAt":{"_seconds":1754093324,"_nanoseconds":748000000},"updatedAt":{"_seconds":1754093324,"_nanoseconds":748000000}}],"total":1}
=== REQUEST END [2025-08-02T03:02:27.209Z] ===


=== REQUEST START [2025-08-02T03:03:09.399Z] ===
POST /auth/register
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Request Body: {
  "name": "bot1",
  "email": "23071A67F4@vnrvjiet.in",
  "password": "qwertyuiop",
  "phone": "9700550849",
  "role": "resident",
  "communityId": "PAWJErgeBMJTEDEuHojc"
}
bot1 23071A67F4@vnrvjiet.in qwertyuiop 9700550849 resident undefined PAWJErgeBMJTEDEuHojc
üé® Template rendering started with data keys: [ 'name', 'otp' ]
üé® Data structure preview: { user: 'undefined', ticket: 'undefined', dataKeys: 'undefined' }
üîç Replacing {{name}} with: "bot1"
üîç Replacing {{otp}} with: "355446"
‚úÖ Template rendering completed
Email sent successfully: <77e3458f-df1b-df07-db0b-729635c423fd@gmail.com>
Response Status: 200
Response Data: {"success":true,"message":"OTP sent to your email. Please verify to complete registration.","email":"23071A67F4@vnrvjiet.in"}
=== REQUEST END [2025-08-02T03:03:11.697Z] ===


=== REQUEST START [2025-08-02T03:03:36.054Z] ===
POST /auth/verify-otp
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Request Body: {
  "email": "23071A67F4@vnrvjiet.in",
  "otp": "355446"
}
Response Status: 201
Response Data: {"success":true,"message":"Email verified and user registered successfully","user":{"id":"Kd4TbdfYwFj3pYA536Hc","name":"bot1","email":"23071A67F4@vnrvjiet.in","role":"resident","communityId":"PAWJErgeBMJTEDEuHojc"},"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJLZDRUYmRmWXdGajNwWUE1MzZIYyIsIm5hbWUiOiJib3QxIiwiZW1haWwiOiIyMzA3MUE2N0Y0QHZucnZqaWV0LmluIiwicm9sZSI6InJlc2lkZW50IiwiY29tbXVuaXR5SWQiOiJQQVdKRXJnZUJNSlRFREV1SG9qYyIsImlhdCI6MTc1NDEwMzgxNiwiZXhwIjoxNzU0NzA4NjE2fQ.G4Zw7EjeVG2RfOtcCUWytxtUEb2zus2jOIS6BizJml4"}
=== REQUEST END [2025-08-02T03:03:36.220Z] ===


=== REQUEST START [2025-08-02T03:03:37.701Z] ===
GET /api/tickets?reportedBy=Kd4TbdfYwFj3pYA536Hc
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { reportedBy: 'Kd4TbdfYwFj3pYA536Hc' }
Response Status: 200
Response Data: {"success":true,"tickets":[],"total":0}
=== REQUEST END [2025-08-02T03:03:37.733Z] ===


=== REQUEST START [2025-08-02T03:03:37.735Z] ===
GET /api/tickets?reportedBy=Kd4TbdfYwFj3pYA536Hc
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { reportedBy: 'Kd4TbdfYwFj3pYA536Hc' }

=== REQUEST START [2025-08-02T03:03:37.739Z] ===
GET /api/tickets?communityId=PAWJErgeBMJTEDEuHojc
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { communityId: 'PAWJErgeBMJTEDEuHojc' }
Response Status: 200
Response Data: [Large response body]
=== REQUEST END [2025-08-02T03:03:37.769Z] ===


=== REQUEST START [2025-08-02T03:03:37.774Z] ===
GET /api/tickets/stats?communityId=PAWJErgeBMJTEDEuHojc
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { communityId: 'PAWJErgeBMJTEDEuHojc' }
Response Status: 200
Response Data: {"success":true,"tickets":[],"total":0}
=== REQUEST END [2025-08-02T03:03:37.778Z] ===


=== REQUEST START [2025-08-02T03:03:37.786Z] ===
GET /api/tickets?communityId=PAWJErgeBMJTEDEuHojc
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { communityId: 'PAWJErgeBMJTEDEuHojc' }
Response Status: 200
Response Data: {"success":true,"stats":{"open":1,"assigned":0,"in_progress":0,"resolved":0,"closed":0,"total":1}}
=== REQUEST END [2025-08-02T03:03:37.820Z] ===

Response Status: 200
Response Data: [Large response body]
=== REQUEST END [2025-08-02T03:03:37.835Z] ===


=== REQUEST START [2025-08-02T03:03:37.876Z] ===
GET /api/tickets/stats?communityId=PAWJErgeBMJTEDEuHojc
IP: ::1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36 Edg/138.0.0.0
Query Params: [Object: null prototype] { communityId: 'PAWJErgeBMJTEDEuHojc' }
Response Status: 200
Response Data: {"success":true,"stats":{"open":1,"assigned":0,"in_progress":0,"resolved":0,"closed":0,"total":1}}
=== REQUEST END [2025-08-02T03:03:37.908Z] ===

