
> bitnap-server@1.0.0 start
> node dist/server.js

Firebase initialized successfully
Server running on port 3000

=== REQUEST START [2025-08-02T02:44:43.446Z] ===
POST /api/notifications/test-assignment
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Request Body: {
  "ticketId": "test-ticket-123",
  "technicianId": "test-tech-456"
}
🧪 Testing assignment email for ticket test-ticket-123 to technician test-tech-456
Response Status: 200
Response Data: {"success":true,"message":"Test assignment email sent successfully","ticketId":"test-ticket-123","technicianId":"test-tech-456"}
=== REQUEST END [2025-08-02T02:44:43.752Z] ===


=== REQUEST START [2025-08-02T02:45:11.360Z] ===
GET /api/tickets
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Response Status: 200
Response Data: [Large response body]
=== REQUEST END [2025-08-02T02:45:11.442Z] ===


=== REQUEST START [2025-08-02T02:45:50.947Z] ===
GET /api/tickets
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Response Status: 200
Response Data: [Large response body]
=== REQUEST END [2025-08-02T02:45:50.991Z] ===


=== REQUEST START [2025-08-02T02:46:14.969Z] ===
POST /api/notifications/test-assignment
IP: ::ffff:127.0.0.1
User-Agent: curl/7.81.0
Request Body: {
  "ticketId": "ScBZ557KVjy3qgRVxO8f",
  "technicianId": "TyfYVgv06CEjz3dBUX4B"
}
🧪 Testing assignment email for ticket ScBZ557KVjy3qgRVxO8f to technician TyfYVgv06CEjz3dBUX4B
No push subscriptions found for user: TyfYVgv06CEjz3dBUX4B
📧 Ticket data loaded for email: {
  id: 'ScBZ557KVjy3qgRVxO8f',
  title: 'paints isuue',
  category: 'painting',
  location: '1d2',
  priority: 'low',
  images: 1,
  hasRequiredTools: true,
  hasRequiredMaterials: false
}
📧 Sending email to sapramroshansai@gmail.com: {
  template: 'ai-ticket-assignment',
  subject: '🤖 AI-Recommended Ticket Assigned',
  hasTicket: true,
  ticketId: 'ScBZ557KVjy3qgRVxO8f',
  dataKeys: [
    'category',
    'location',
    'assignedBy',
    'assignmentMethod',
    'assignmentReason',
    'assignmentScore',
    'estimatedDuration',
    'requiredTools',
    'requiredMaterials',
    'difficultyLevel'
  ]
}
🎨 Template rendering started with data keys: [ 'user', 'ticket', 'message', 'title', 'data', 'timestamp' ]
🎨 Data structure preview: {
  user: { name: 'Roshan Sai Sapram', email: 'sapramroshansai@gmail.com' },
  ticket: {
    id: 'ScBZ557KVjy3qgRVxO8f',
    title: 'paints isuue',
    category: 'painting',
    imagesCount: 1
  },
  dataKeys: [
    'category',
    'location',
    'assignedBy',
    'assignmentMethod',
    'assignmentReason',
    'assignmentScore',
    'estimatedDuration',
    'requiredTools',
    'requiredMaterials',
    'difficultyLevel'
  ]
}
🔍 Replacing {{user.name}} with: "Roshan Sai Sapram"
🔍 Replacing {{ticket.title}} with: "paints isuue"
🔍 Replacing {{ticket.id}} with: "ScBZ557KVjy3qgRVxO8f"
🔍 Replacing {{ticket.category}} with: "painting"
🔍 Replacing {{ticket.priority}} with: "low"
🔍 Replacing {{ticket.priority}} with: "low"
🔍 Replacing {{ticket.location}} with: "1d2"
🔍 Replacing {{timestamp}} with: "8/2/2025"
🔍 Replacing {{ticket.description}} with: "paints isuue"
🔍 Replacing {{data.assignmentScore}} with: "95"
🔍 Replacing {{data.difficultyLevel}} with: "medium"
🔍 Replacing {{data.estimatedDuration}} with: "2-3 hours"
🔍 Replacing {{ticket.category}} with: "painting"
✅ Template rendering completed
Email sent successfully: <63d78bfc-567a-74d9-6613-2583db70ac0c@gmail.com>
Email notification sent to sapramroshansai@gmail.com for new_assignment
No push subscriptions found for user: qyOHu27ym5DOB5ZO7NoF
Response Status: 200
Response Data: {"success":true,"message":"Test assignment email sent successfully","ticketId":"ScBZ557KVjy3qgRVxO8f","technicianId":"TyfYVgv06CEjz3dBUX4B"}
=== REQUEST END [2025-08-02T02:46:17.763Z] ===

